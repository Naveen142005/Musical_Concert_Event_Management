<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Step Booking Wizard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'custom-purple': 'rgb(168 85 247)',
                    }
                }
            }
        }
    </script>
    <style>
        .step-transition {
            transition: all 0.3s ease-in-out;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
            transition: all 0.3s ease-in-out;
        }
        
        .calendar-day {
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            transform: scale(1.05);
        }
        
        .searchable-dropdown {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .quantity-btn {
            transition: all 0.15s ease;
        }
        
        .quantity-btn:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen py-8">
    <!-- Main Container -->
    <div class="max-w-4xl mx-auto px-4">
        <!-- Progress Steps -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <div id="step-indicator-1" class="step-indicator flex items-center space-x-2">
                    <div class="w-10 h-10 rounded-full bg-custom-purple text-white flex items-center justify-center font-bold">1</div>
                    <span class="text-sm font-medium text-custom-purple hidden sm:block">Basic Info</span>
                </div>
                <div id="step-indicator-2" class="step-indicator flex items-center space-x-2">
                    <div class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">2</div>
                    <span class="text-sm font-medium text-gray-600 hidden sm:block">Event Setup</span>
                </div>
                <div id="step-indicator-3" class="step-indicator flex items-center space-x-2">
                    <div class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">3</div>
                    <span class="text-sm font-medium text-gray-600 hidden sm:block">Calendar</span>
                </div>
                <div id="step-indicator-4" class="step-indicator flex items-center space-x-2">
                    <div class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">4</div>
                    <span class="text-sm font-medium text-gray-600 hidden sm:block">Tickets</span>
                </div>
                <div id="step-indicator-5" class="step-indicator flex items-center space-x-2">
                    <div class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">5</div>
                    <span class="text-sm font-medium text-gray-600 hidden sm:block">Payment</span>
                </div>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div id="progress-bar" class="bg-custom-purple h-2 rounded-full step-transition" style="width: 20%"></div>
            </div>
        </div>

        <!-- Form Container -->
        <div class="bg-white rounded-xl shadow-lg p-8">
            <form id="bookingForm">
                <!-- Step 1: Basic Information -->
                <div id="step-content-1" class="step-content">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Basic Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                            <input type="text" id="fullName" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                            <input type="email" id="email" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number *</label>
                            <input type="tel" id="phone" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Address *</label>
                            <input type="text" id="address" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                        </div>
                    </div>
                </div>

                <!-- Step 2: Event Setup -->
                <div id="step-content-2" class="step-content hidden">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Event Setup</h2>
                    
                    <!-- Venue Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Venue *</label>
                        <div class="relative">
                            <input type="text" id="venueSearch" placeholder="Search venues..." 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                            <div id="venueDropdown" class="absolute z-10 w-full bg-white border border-gray-300 rounded-xl mt-1 hidden searchable-dropdown shadow-lg">
                            </div>
                        </div>
                        <div id="selectedVenue" class="mt-2"></div>
                    </div>

                    <!-- Band Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Band *</label>
                        <div class="relative">
                            <input type="text" id="bandSearch" placeholder="Search bands..." 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                            <div id="bandDropdown" class="absolute z-10 w-full bg-white border border-gray-300 rounded-xl mt-1 hidden searchable-dropdown shadow-lg">
                            </div>
                        </div>
                        <div id="selectedBand" class="mt-2"></div>
                    </div>

                    <!-- Decoration Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Decorations</label>
                        <div class="relative">
                            <input type="text" id="decorSearch" placeholder="Search decorations..." 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                            <div id="decorDropdown" class="absolute z-10 w-full bg-white border border-gray-300 rounded-xl mt-1 hidden searchable-dropdown shadow-lg">
                            </div>
                        </div>
                        <div id="selectedDecor" class="mt-2"></div>
                    </div>

                    <!-- Snacks & Beverages -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-4">Snacks & Beverages</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-gray-50 rounded-xl p-4 shadow-sm">
                                <h4 class="font-medium text-gray-900 mb-2">ü•§ Fresh Juice</h4>
                                <div class="flex items-center justify-center space-x-3">
                                    <button type="button" class="quantity-btn w-8 h-8 bg-custom-purple text-white rounded-full hover:bg-purple-700 shadow-sm" onclick="updateQuantity('juice', -1)">-</button>
                                    <span id="juice-qty" class="w-12 text-center font-medium text-lg">0</span>
                                    <button type="button" class="quantity-btn w-8 h-8 bg-custom-purple text-white rounded-full hover:bg-purple-700 shadow-sm" onclick="updateQuantity('juice', 1)">+</button>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-xl p-4 shadow-sm">
                                <h4 class="font-medium text-gray-900 mb-2">ü•§ Soft Drinks</h4>
                                <div class="flex items-center justify-center space-x-3">
                                    <button type="button" class="quantity-btn w-8 h-8 bg-custom-purple text-white rounded-full hover:bg-purple-700 shadow-sm" onclick="updateQuantity('softdrinks', -1)">-</button>
                                    <span id="softdrinks-qty" class="w-12 text-center font-medium text-lg">0</span>
                                    <button type="button" class="quantity-btn w-8 h-8 bg-custom-purple text-white rounded-full hover:bg-purple-700 shadow-sm" onclick="updateQuantity('softdrinks', 1)">+</button>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-xl p-4 shadow-sm">
                                <h4 class="font-medium text-gray-900 mb-2">üçø Snacks</h4>
                                <div class="flex items-center justify-center space-x-3">
                                    <button type="button" class="quantity-btn w-8 h-8 bg-custom-purple text-white rounded-full hover:bg-purple-700 shadow-sm" onclick="updateQuantity('snacks', -1)">-</button>
                                    <span id="snacks-qty" class="w-12 text-center font-medium text-lg">0</span>
                                    <button type="button" class="quantity-btn w-8 h-8 bg-custom-purple text-white rounded-full hover:bg-purple-700 shadow-sm" onclick="updateQuantity('snacks', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Availability Calendar -->
                <div id="step-content-3" class="step-content hidden">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Select Available Date</h2>
                    <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <button type="button" id="prevMonth" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <h3 id="currentMonth" class="text-lg font-semibold"></h3>
                            <button type="button" id="nextMonth" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="grid grid-cols-7 gap-1 mb-2">
                            <div class="text-center text-sm font-medium text-gray-500 py-2">Sun</div>
                            <div class="text-center text-sm font-medium text-gray-500 py-2">Mon</div>
                            <div class="text-center text-sm font-medium text-gray-500 py-2">Tue</div>
                            <div class="text-center text-sm font-medium text-gray-500 py-2">Wed</div>
                            <div class="text-center text-sm font-medium text-gray-500 py-2">Thu</div>
                            <div class="text-center text-sm font-medium text-gray-500 py-2">Fri</div>
                            <div class="text-center text-sm font-medium text-gray-500 py-2">Sat</div>
                        </div>
                        <div id="calendarGrid" class="grid grid-cols-7 gap-1">
                            <!-- Calendar days will be populated here -->
                        </div>
                        <div id="selectedDate" class="mt-4 text-center"></div>
                        <div id="availabilityMessage" class="mt-4 text-center text-sm"></div>
                    </div>
                </div>

                <!-- Step 4: Tickets & Pricing -->
                <div id="step-content-4" class="step-content hidden">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Tickets & Pricing</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ticket Type *</label>
                            <select id="ticketType" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                                <option value="">Select ticket type</option>
                                <option value="standard">Standard</option>
                                <option value="premium">Premium</option>
                                <option value="vip">VIP</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ticket Price ($) *</label>
                            <input type="number" id="ticketPrice" required min="0" step="0.01" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Expected Audience Size *</label>
                            <input type="number" id="audienceSize" required min="1" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Total Revenue</label>
                            <input type="text" id="totalRevenue" readonly 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-50 shadow-sm">
                        </div>
                    </div>
                </div>

                <!-- Step 5: Payment & Confirmation -->
                <div id="step-content-5" class="step-content hidden">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Payment & Confirmation</h2>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Payment Method *</label>
                            <select id="paymentMethod" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-custom-purple focus:border-transparent shadow-sm">
                                <option value="">Select payment method</option>
                                <option value="card">üí≥ Credit/Debit Card</option>
                                <option value="upi">üì± UPI</option>
                                <option value="cash">üíµ Cash</option>
                            </select>
                        </div>
                        <div class="flex items-start space-x-3">
                            <input type="checkbox" id="confirmBooking" required 
                                   class="mt-1 h-4 w-4 text-custom-purple focus:ring-custom-purple border-gray-300 rounded">
                            <label for="confirmBooking" class="text-sm text-gray-700">
                                I confirm my booking and agree to the terms and conditions
                            </label>
                        </div>
                        <div class="text-center">
                            <button type="button" onclick="showBookingModal()" 
                                    class="bg-custom-purple hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200">
                                üìã View Details
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="flex justify-between mt-8">
                    <button type="button" id="prevBtn" onclick="previousStep()" 
                            class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-3 px-6 rounded-xl transition-all duration-200 shadow-sm hidden">
                        ‚Üê Previous
                    </button>
                    <button type="button" id="nextBtn" onclick="nextStep()" 
                            class="bg-custom-purple hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl">
                        Next ‚Üí
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Booking Review Modal -->
    <div id="bookingModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto border-4 border-custom-purple">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-900">üìã Booking Summary</h3>
                    <button type="button" onclick="hideBookingModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div id="bookingSummary" class="space-y-4">
                    <!-- Booking summary will be populated here -->
                </div>
                <div class="flex space-x-4 mt-8">
                    <button type="button" onclick="confirmBooking()" 
                            class="flex-1 bg-custom-purple hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg">
                        ‚úÖ Confirm Booking
                    </button>
                    <button type="button" onclick="hideBookingModal()" 
                            class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-3 px-6 rounded-xl transition-all duration-200 shadow-sm">
                        ‚ùå Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
let currentStep = 1;
let selectedVenue = null;
let selectedBand = null;
let selectedDecor = null;
let selectedDate = null;
let currentDate = new Date();
let snackQuantities = { juice: 0, softdrinks: 0, snacks: 0 };

// Sample data (replace with API calls in production)
const venues = [
    { id: 1, name: 'Grand Ballroom', capacity: 500, price: 1000, location: 'Downtown' },
    { id: 2, name: 'Garden Pavilion', capacity: 200, price: 600, location: 'Uptown' },
    { id: 3, name: 'Rooftop Terrace', capacity: 150, price: 400, location: 'City Center' },
    { id: 4, name: 'Conference Hall', capacity: 300, price: 800, location: 'Business District' },
    { id: 5, name: 'Luxury Suite', capacity: 100, price: 1200, location: 'Premium Area' }
];

const bands = [
    { id: 1, name: 'The Jazz Collective', genre: 'Jazz', price: 2000, members: 5 },
    { id: 2, name: 'Rock Revolution', genre: 'Rock', price: 2500, members: 4 },
    { id: 3, name: 'Acoustic Dreams', genre: 'Acoustic', price: 1500, members: 3 },
    { id: 4, name: 'Electronic Vibes', genre: 'Electronic', price: 1800, members: 2 },
    { id: 5, name: 'Classical Ensemble', genre: 'Classical', price: 2200, members: 6 }
];

const decorations = [
    { id: 1, name: 'Elegant White Theme', style: 'Classic', price: 500, description: 'Timeless elegance' },
    { id: 2, name: 'Colorful Garden Party', style: 'Vibrant', price: 600, description: 'Bright and cheerful' },
    { id: 3, name: 'Modern Minimalist', style: 'Contemporary', price: 400, description: 'Clean and simple' },
    { id: 4, name: 'Vintage Romance', style: 'Rustic', price: 550, description: 'Charming and cozy' },
    { id: 5, name: 'Luxury Gold', style: 'Premium', price: 800, description: 'Opulent and grand' }
];

// Simulate booking data (in production, fetch from backend)
const bookings = [
    { venueId: 1, bandId: 1, decorId: 1, date: '2025-09-20' },
    { venueId: 2, bandId: 3, decorId: 2, date: '2025-09-22' },
    { venueId: 3, bandId: 2, decorId: 3, date: '2025-09-25' }
];

// Initialize the form
document.addEventListener('DOMContentLoaded', function() {
    initializeSearchables();
    initializeCalendar();
    updateTotalRevenue();
});

// Step navigation functions
function nextStep() {
    if (validateCurrentStep()) {
        if (currentStep < 5) {
            currentStep++;
            showStep(currentStep);
            updateProgressBar();
        }
    }
}

function previousStep() {
    if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
        updateProgressBar();
    }
}

function showStep(step) {
    // Hide all step contents
    document.querySelectorAll('.step-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Show current step content
    document.getElementById(`step-content-${step}`).classList.remove('hidden');
    
    // Update step indicators
    updateStepIndicators(step);
    
    // Update navigation buttons
    updateNavigationButtons(step);
    
    // Initialize calendar when showing step 3
    if (step === 3) {
        updateCalendarDisplay();
    }
}

function updateStepIndicators(step) {
    for (let i = 1; i <= 5; i++) {
        const indicator = document.getElementById(`step-indicator-${i}`);
        const circle = indicator.querySelector('div');
        const text = indicator.querySelector('span');
        
        if (i < step) {
            circle.className = 'w-10 h-10 rounded-full bg-green-600 text-white flex items-center justify-center font-bold';
            circle.innerHTML = '‚úì';
            text.className = 'text-sm font-medium text-green-600 hidden sm:block';
        } else if (i === step) {
            circle.className = 'w-10 h-10 rounded-full bg-custom-purple text-white flex items-center justify-center font-bold';
            circle.innerHTML = i;
            text.className = 'text-sm font-medium text-custom-purple hidden sm:block';
        } else {
            circle.className = 'w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold';
            circle.innerHTML = i;
            text.className = 'text-sm font-medium text-gray-600 hidden sm:block';
        }
    }
}

function updateProgressBar() {
    const progress = (currentStep / 5) * 100;
    document.getElementById('progress-bar').style.width = `${progress}%`;
}

function updateNavigationButtons(step) {
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    if (step === 1) {
        prevBtn.classList.add('hidden');
    } else {
        prevBtn.classList.remove('hidden');
    }
    
    if (step === 5) {
        nextBtn.classList.add('hidden');
    } else {
        nextBtn.classList.remove('hidden');
    }
}

// Validation functions
function validateCurrentStep() {
    switch (currentStep) {
        case 1:
            return validateBasicInfo();
        case 2:
            return validateEventSetup();
        case 3:
            return validateCalendar();
        case 4:
            return validateTickets();
        case 5:
            return validatePayment();
        default:
            return true;
    }
}

function validateBasicInfo() {
    const fields = ['fullName', 'email', 'phone', 'address'];
    let isValid = true;
    
    fields.forEach(field => {
        const element = document.getElementById(field);
        if (!element.value.trim()) {
            element.classList.add('border-red-500');
            isValid = false;
        } else {
            element.classList.remove('border-red-500');
        }
    });
    
    // Email validation
    const email = document.getElementById('email');
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (email.value && !emailRegex.test(email.value)) {
        email.classList.add('border-red-500');
        isValid = false;
    }
    
    if (!isValid) {
        alert('Please fill in all required fields correctly.');
    }
    
    return isValid;
}

function validateEventSetup() {
    if (!selectedVenue || !selectedBand) {
        alert('Please select both a venue and a band.');
        return false;
    }
    return true;
}

function validateCalendar() {
    if (!selectedDate) {
        alert('Please select an available date.');
        return false;
    }
    return true;
}

function validateTickets() {
    const ticketType = document.getElementById('ticketType').value;
    const ticketPrice = document.getElementById('ticketPrice').value;
    const audienceSize = document.getElementById('audienceSize').value;
    
    if (!ticketType || !ticketPrice || !audienceSize) {
        alert('Please fill in all ticket information.');
        return false;
    }
    
    return true;
}

function validatePayment() {
    const paymentMethod = document.getElementById('paymentMethod').value;
    const confirmBooking = document.getElementById('confirmBooking').checked;
    
    if (!paymentMethod || !confirmBooking) {
        alert('Please select a payment method and confirm your booking.');
        return false;
    }
    
    return true;
}

// Initialize searchable dropdowns
function initializeSearchables() {
    initializeVenueSearch();
    initializeBandSearch();
    initializeDecorSearch();
}

function initializeVenueSearch() {
    const searchInput = document.getElementById('venueSearch');
    const dropdown = document.getElementById('venueDropdown');
    
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const filteredVenues = venues.filter(venue => 
            venue.name.toLowerCase().includes(searchTerm) ||
            venue.location.toLowerCase().includes(searchTerm)
        );
        
        displayVenueOptions(filteredVenues);
        dropdown.classList.remove('hidden');
    });
    
    searchInput.addEventListener('focus', function() {
        displayVenueOptions(venues);
        dropdown.classList.remove('hidden');
    });
    
    // Hide dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.classList.add('hidden');
        }
    });
}

function displayVenueOptions(venueList) {
    const dropdown = document.getElementById('venueDropdown');
    dropdown.innerHTML = '';
    
    venueList.forEach(venue => {
        const option = document.createElement('div');
        option.className = 'px-4 py-3 hover:bg-purple-50 cursor-pointer border-b border-gray-100 transition-colors';
        option.innerHTML = `
            <div class="font-medium text-gray-900">${venue.name}</div>
            <div class="text-sm text-gray-500">üìç ${venue.location} | üë• ${venue.capacity} | üí∞ $${venue.price}</div>
        `;
        option.addEventListener('click', function() {
            selectVenue(venue);
        });
        dropdown.appendChild(option);
    });
}

function selectVenue(venue) {
    selectedVenue = venue;
    document.getElementById('venueSearch').value = venue.name;
    document.getElementById('venueDropdown').classList.add('hidden');
    
    document.getElementById('selectedVenue').innerHTML = `
        <div class="bg-purple-50 border border-custom-purple rounded-xl p-3">
            <div class="font-medium text-purple-900">${venue.name}</div>
            <div class="text-sm text-purple-700">üìç ${venue.location} | üë• ${venue.capacity} | üí∞ $${venue.price}</div>
        </div>
    `;
}

function initializeBandSearch() {
    const searchInput = document.getElementById('bandSearch');
    const dropdown = document.getElementById('bandDropdown');
    
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const filteredBands = bands.filter(band => 
            band.name.toLowerCase().includes(searchTerm) || 
            band.genre.toLowerCase().includes(searchTerm)
        );
        
        displayBandOptions(filteredBands);
        dropdown.classList.remove('hidden');
    });
    
    searchInput.addEventListener('focus', function() {
        displayBandOptions(bands);
        dropdown.classList.remove('hidden');
    });
    
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.classList.add('hidden');
        }
    });
}

function displayBandOptions(bandList) {
    const dropdown = document.getElementById('bandDropdown');
    dropdown.innerHTML = '';
    
    bandList.forEach(band => {
        const option = document.createElement('div');
        option.className = 'px-4 py-3 hover:bg-purple-50 cursor-pointer border-b border-gray-100 transition-colors';
        option.innerHTML = `
            <div class="font-medium text-gray-900">${band.name}</div>
            <div class="text-sm text-gray-500">üéµ ${band.genre} | üë• ${band.members} members | üí∞ $${band.price}</div>
        `;
        option.addEventListener('click', function() {
            selectBand(band);
        });
        dropdown.appendChild(option);
    });
}

function selectBand(band) {
    selectedBand = band;
    document.getElementById('bandSearch').value = band.name;
    document.getElementById('bandDropdown').classList.add('hidden');
    
    document.getElementById('selectedBand').innerHTML = `
        <div class="bg-purple-50 border border-custom-purple rounded-xl p-3">
            <div class="font-medium text-purple-900">${band.name}</div>
            <div class="text-sm text-purple-700">üéµ ${band.genre} | üë• ${band.members} members | üí∞ $${band.price}</div>
        </div>
    `;
}

function initializeDecorSearch() {
    const searchInput = document.getElementById('decorSearch');
    const dropdown = document.getElementById('decorDropdown');
    
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const filteredDecor = decorations.filter(decor => 
            decor.name.toLowerCase().includes(searchTerm) || 
            decor.style.toLowerCase().includes(searchTerm)
        );
        
        displayDecorOptions(filteredDecor);
        dropdown.classList.remove('hidden');
    });
    
    searchInput.addEventListener('focus', function() {
        displayDecorOptions(decorations);
        dropdown.classList.remove('hidden');
    });
    
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.classList.add('hidden');
        }
    });
}

function displayDecorOptions(decorList) {
    const dropdown = document.getElementById('decorDropdown');
    dropdown.innerHTML = '';
    
    decorList.forEach(decor => {
        const option = document.createElement('div');
        option.className = 'px-4 py-3 hover:bg-purple-50 cursor-pointer border-b border-gray-100 transition-colors';
        option.innerHTML = `
            <div class="font-medium text-gray-900">${decor.name}</div>
            <div class="text-sm text-gray-500">üé® ${decor.style} | ${decor.description} | üí∞ $${decor.price}</div>
        `;
        option.addEventListener('click', function() {
            selectDecor(decor);
        });
        dropdown.appendChild(option);
    });
}

function selectDecor(decor) {
    selectedDecor = decor;
    document.getElementById('decorSearch').value = decor.name;
    document.getElementById('decorDropdown').classList.add('hidden');
    
    document.getElementById('selectedDecor').innerHTML = `
        <div class="bg-purple-50 border border-custom-purple rounded-xl p-3">
            <div class="font-medium text-purple-900">${decor.name}</div>
            <div class="text-sm text-purple-700">üé® ${decor.style} | ${decor.description} | üí∞ $${decor.price}</div>
        </div>
    `;
}

// Quantity management
function updateQuantity(item, change) {
    snackQuantities[item] = Math.max(0, snackQuantities[item] + change);
    document.getElementById(`${item}-qty`).textContent = snackQuantities[item];
}

// Calendar functions
function initializeCalendar() {
    updateCalendarDisplay();
    
    document.getElementById('prevMonth').addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        updateCalendarDisplay();
    });
    
    document.getElementById('nextMonth').addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        updateCalendarDisplay();
    });
}

function updateCalendarDisplay() {
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'];
    
    document.getElementById('currentMonth').textContent = 
        `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
    
    const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
    const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    const calendarGrid = document.getElementById('calendarGrid');
    calendarGrid.innerHTML = '';
    
    const today = new Date();
    const maxDate = new Date();
    maxDate.setMonth(maxDate.getMonth() + 3);
    
    for (let i = 0; i < 42; i++) {
        const cellDate = new Date(startDate);
        cellDate.setDate(startDate.getDate() + i);
        
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day w-10 h-10 flex items-center justify-center text-sm cursor-pointer rounded-lg';
        dayElement.textContent = cellDate.getDate();
        
        const isCurrentMonth = cellDate.getMonth() === currentDate.getMonth();
        const isToday = cellDate.toDateString() === today.toDateString();
        const isPast = cellDate < today;
        const isFuture = cellDate > maxDate;
        const availability = checkAvailability(cellDate);
        
        if (isPast || isFuture || !isCurrentMonth) {
            dayElement.className += ' text-gray-400 cursor-not-allowed';
        } else if (availability.available) {
            dayElement.className += ' bg-green-100 text-green-800 hover:bg-green-200 shadow-sm';
            dayElement.addEventListener('click', function() {
                selectDate(cellDate);
            });
        } else {
            dayElement.className += ' bg-red-100 text-red-800 cursor-not-allowed shadow-sm';
            dayElement.title = availability.message;
        }
        
        if (isToday) {
            dayElement.className += ' ring-2 ring-blue-500';
        }
        
        if (selectedDate && cellDate.toDateString() === selectedDate.toDateString()) {
            dayElement.className = dayElement.className.replace('bg-green-100 text-green-800', 'bg-custom-purple text-white');
        }
        
        calendarGrid.appendChild(dayElement);
    }
}

function checkAvailability(date) {
    const dateStr = date.toISOString().split('T')[0];
    
    // Check if the selected venue, band, or decoration is already booked
    const conflictingBooking = bookings.find(booking => 
        booking.date === dateStr && (
            (selectedVenue && booking.venueId === selectedVenue.id) ||
            (selectedBand && booking.bandId === selectedBand.id) ||
            (selectedDecor && booking.decorId === selectedDecor.id)
        )
    );
    
    if (conflictingBooking) {
        let unavailableItems = [];
        if (selectedVenue && conflictingBooking.venueId === selectedVenue.id) {
            unavailableItems.push('Venue');
        }
        if (selectedBand && conflictingBooking.bandId === selectedBand.id) {
            unavailableItems.push('Band');
        }
        if (selectedDecor && conflictingBooking.decorId === selectedDecor.id) {
            unavailableItems.push('Decoration');
        }
        
        return {
            available: false,
            message: `${unavailableItems.join(', ')} not available on this date`
        };
    }
    
    // Simulate random availability for demo purposes
    const dayOfWeek = date.getDay();
    const random = Math.random();
    
    // Make weekends less available
    if (dayOfWeek === 0 || dayOfWeek === 6) {
        return {
            available: random > 0.4,
            message: random <= 0.4 ? 'Popular weekend date - fully booked' : 'Available'
        };
    }
    
    return {
        available: random > 0.2,
        message: random <= 0.2 ? 'High demand date - fully booked' : 'Available'
    };
}

function selectDate(date) {
    selectedDate = date;
    updateCalendarDisplay();
    
    const availability = checkAvailability(date);
    
    document.getElementById('selectedDate').innerHTML = `
        <div class="bg-purple-50 border border-custom-purple rounded-xl p-3">
            <div class="font-medium text-purple-900">Selected Date</div>
            <div class="text-purple-700">${date.toLocaleDateString()}</div>
        </div>
    `;
    
    // Show availability message
    const messageEl = document.getElementById('availabilityMessage');
    if (!availability.available) {
        messageEl.innerHTML = `
            <div class="text-orange-600 font-medium">
                ‚ö†Ô∏è ${availability.message}. Consider selecting alternative options or another date.
            </div>
        `;
    } else {
        messageEl.innerHTML = `
            <div class="text-green-600 font-medium">
                ‚úÖ All selected items are available on this date!
            </div>
        `;
    }
}

// Revenue calculation
function updateTotalRevenue() {
    const ticketPrice = parseFloat(document.getElementById('ticketPrice').value) || 0;
    const audienceSize = parseInt(document.getElementById('audienceSize').value) || 0;
    const total = ticketPrice * audienceSize;
    
    document.getElementById('totalRevenue').value = `$${total.toFixed(2)}`;
}

// Add event listeners for revenue calculation
document.getElementById('ticketPrice').addEventListener('input', updateTotalRevenue);
document.getElementById('audienceSize').addEventListener('input', updateTotalRevenue);

// Modal functions
function showBookingModal() {
    if (!validatePayment()) {
        return;
    }
    
    generateBookingSummary();
    document.getElementById('bookingModal').classList.remove('hidden');
    document.getElementById('bookingModal').classList.add('flex');
}

function hideBookingModal() {
    document.getElementById('bookingModal').classList.add('hidden');
    document.getElementById('bookingModal').classList.remove('flex');
}

function generateBookingSummary() {
    const summary = document.getElementById('bookingSummary');
    
    // Calculate totals
    let totalCost = 0;
    if (selectedVenue) totalCost += selectedVenue.price;
    if (selectedBand) totalCost += selectedBand.price;
    if (selectedDecor) totalCost += selectedDecor.price;
    
    // Add snack costs ($5 per item)
    const snackCost = (snackQuantities.juice + snackQuantities.softdrinks + snackQuantities.snacks) * 5;
    totalCost += snackCost;
    
    const ticketPrice = parseFloat(document.getElementById('ticketPrice').value) || 0;
    const audienceSize = parseInt(document.getElementById('audienceSize').value) || 0;
    const ticketRevenue = ticketPrice * audienceSize;
    
    summary.innerHTML = `
        <div class="space-y-4">
            <div class="bg-gray-50 rounded-xl p-4">
                <h4 class="font-bold text-gray-900 mb-3 flex items-center">
                    <span class="mr-2">üë§</span>Basic Information
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                    <p><strong>Name:</strong> ${document.getElementById('fullName').value}</p>
                    <p><strong>Email:</strong> ${document.getElementById('email').value}</p>
                    <p><strong>Phone:</strong> ${document.getElementById('phone').value}</p>
                    <p><strong>Address:</strong> ${document.getElementById('address').value}</p>
                </div>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-4">
                <h4 class="font-bold text-gray-900 mb-3 flex items-center">
                    <span class="mr-2">üè¢</span>Event Details
                </h4>
                <div class="space-y-2 text-sm">
                    <p><strong>üìç Venue:</strong> ${selectedVenue ? `${selectedVenue.name} - ${selectedVenue.location} ($${selectedVenue.price})` : 'Not selected'}</p>
                    <p><strong>üéµ Band:</strong> ${selectedBand ? `${selectedBand.name} - ${selectedBand.genre} ($${selectedBand.price})` : 'Not selected'}</p>
                    <p><strong>üé® Decorations:</strong> ${selectedDecor ? `${selectedDecor.name} - ${selectedDecor.style} ($${selectedDecor.price})` : 'None selected'}</p>
                    <p><strong>üìÖ Date:</strong> ${selectedDate ? selectedDate.toLocaleDateString() : 'Not selected'}</p>
                </div>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-4">
                <h4 class="font-bold text-gray-900 mb-3 flex items-center">
                    <span class="mr-2">üçø</span>Snacks & Beverages
                </h4>
                <div class="grid grid-cols-3 gap-4 text-sm">
                    <p><strong>ü•§ Juice:</strong> ${snackQuantities.juice} items</p>
                    <p><strong>ü•§ Soft Drinks:</strong> ${snackQuantities.softdrinks} items</p>
                    <p><strong>üçø Snacks:</strong> ${snackQuantities.snacks} items</p>
                </div>
                <p class="text-sm mt-2"><strong>Total Snack Cost:</strong> $${snackCost}</p>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-4">
                <h4 class="font-bold text-gray-900 mb-3 flex items-center">
                    <span class="mr-2">üé´</span>Tickets & Revenue
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                    <p><strong>Ticket Type:</strong> ${document.getElementById('ticketType').value}</p>
                    <p><strong>Ticket Price:</strong> $${ticketPrice}</p>
                    <p><strong>Expected Audience:</strong> ${audienceSize} people</p>
                    <p><strong>Expected Revenue:</strong> $${ticketRevenue}</p>
                </div>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-4">
                <h4 class="font-bold text-gray-900 mb-3 flex items-center">
                    <span class="mr-2">üí≥</span>Payment Information
                </h4>
                <p class="text-sm"><strong>Payment Method:</strong> ${document.getElementById('paymentMethod').value}</p>
            </div>
            
            <div class="bg-purple-50 border-2 border-custom-purple rounded-xl p-4">
                <h4 class="font-bold text-purple-900 mb-2 flex items-center">
                    <span class="mr-2">üí∞</span>Total Event Cost
                </h4>
                <p class="text-3xl font-bold text-custom-purple">$${totalCost.toLocaleString()}</p>
                <p class="text-sm text-purple-700 mt-1">Net Profit: $${(ticketRevenue - totalCost).toLocaleString()}</p>
            </div>
        </div>
    `;
}

function confirmBooking() {
    // Here you would typically submit the booking to your backend
    alert('üéâ Booking confirmed successfully! You will receive a confirmation email shortly.');
    hideBookingModal();
    
    // Reset form or redirect to success page
    // window.location.href = '/success';
}

// Initialize on page load
showStep(1);

    </script>
</body>
</html>
